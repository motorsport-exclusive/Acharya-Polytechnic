<!DOCTYPE html>
<html>
  <head>
    <link
      rel="stylesheet"
      href="css.css"
    />
    <title>Acharya Polytechnic</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  </head>
  <body>
    <section class="hero is-primary is-bold">
      <div class="hero-body">
        <div class="container has-text-centered">
          <h1>Acharya Polytechnic</h1>
          <h2 class="title">International Photography Day</h2>
          <h3 class="subtitle">
            Showcase your best shots! Upload your work and stand a chance to be featured.  
          </h3>
        </div>
      </div>
    </section>

    <form id="form" class="container m-4 pl-4">
      <div class="field">
        <label class="label">Name</label>
        <div class="control">
          <input class="input" type="text" placeholder="Your Name" name="Name" />
        </div>
      </div>

      <div class="field">
        <label class="label">Email</label>
        <div class="control">
          <input
            class="input"
            type="email"
            placeholder="Your Email"
            name="Email"
          />
        </div>
      </div>

      <div class="field">
        <label class="label">Mobile Number</label>
        <div class="control">
          <input
            class="input"
            type="number"
            placeholder="+91-1234567890"
            name="Mobile"
          />
        </div>
      </div>

      <div class="field">
        <label class="label">Instagram</label>
        <div class="control">
          <input
            class="input"
            type="text"
            placeholder="@username"
            name="ig"
          />
        </div>
      </div>

      <div class="field">
        <label class="label">Upload Your Work (one pic per participant)</label>
        <div class="control">
          <div class="file has-name is-fullwidth">
            <label class="file-label">
              <input
                class="file-input"
                type="file"
                name="theFile"
                id="fileInput"
                accept="image/*"
              />
              <span class="file-cta">
                <span class="file-icon">
                  <i class="fas fa-upload"></i>
                </span>
                <span class="file-label"> Choose a photo… </span>
              </span>
              <span class="file-name" id="fileNameDisplay">
                No file selected
              </span>
            </label>
          </div>
        </div>
      </div>

      <input type="hidden" name="filename" id="actualFilename" />

      <div class="field is-grouped buttons-wrap">
        <div class="control">
          <button class="button is-primary" type="submit" id="submit-button">
            Submit
          </button>
        </div>
        <div class="control">
          <button
            class="button is-danger"
            type="button"
            onclick="document.getElementById('form').reset(); document.getElementById('fileNameDisplay').textContent = 'No file selected';"
          >
            Clear
          </button>
        </div>
      </div>
    </form>

    <div
      id="message"
      style="
        display: none;
        margin: 20px;
        padding: 10px;
        border-radius: 4px;
        font-weight: bold;
      "
    ></div>

<!-- Footer / Credit -->
<footer class="has-text-centered" style="margin-top: 50px; padding: 20px;">
  <a href="mailto:contact.acharyapolytechnic@gmail.com" 
     target="_blank" 
     class="credit-logo">
    contact: acharyapolytechnic@gmail.com
  </a>
</footer>

<style>
/* Footer Credit Logo Style - Minimal Badge */
.credit-logo {
  display: inline-block;
  padding: 4px 14px;
  border-radius: 50px;
  border: 1px solid rgba(0, 0, 0, 0.4); 
  color: rgba(0, 0, 0, 0.5);
  text-decoration: none;
  font-weight: 500;
  letter-spacing: 0.3px;
  font-size: 0.7rem;
  background: transparent;
  transition: all 0.25s ease;
}
.credit-logo:hover {
  border-color: #000000;
  color: #000000;
}

/* ✅ Mobile Responsive Tweaks */
form {
  max-width: 600px;
  margin: auto;
}
.input, .file-label {
  width: 100%;
}
.file-name {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 100%;
  display: inline-block;
}
.buttons-wrap {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
}
.buttons-wrap .control {
  flex: 1 1 auto;
}
@media (max-width: 480px) {
  .title {
    font-size: 1.4rem;
  }
  .subtitle {
    font-size: 1rem;
  }
  .button {
    width: 100%;
  }
}
</style>

<script>
  const form = document.getElementById("form");
  const submitButton = document.getElementById("submit-button");
  const messageDiv = document.getElementById("message");
  const fileInput = document.getElementById("fileInput");
  const fileNameDisplay = document.getElementById("fileNameDisplay");

  fileInput.addEventListener("change", function () {
    if (this.files && this.files.length > 0) {
      fileNameDisplay.textContent = this.files[0].name;
    } else {
      fileNameDisplay.textContent = "No file selected";
    }
  });

  async function uploadFile(file) {
    return new Promise((resolve, reject) => {
      const fr = new FileReader();
      fr.onload = (e) => {
        const data = e.target.result.split(",");
        const obj = {
          fileName: file.name,
          mimeType: data[0].match(/:(\w.+);/)[1],
          data: data[1],
        };
        resolve(obj);
      };
      fr.onerror = reject;
      fr.readAsDataURL(file);
    });
  }

  form.addEventListener("submit", async function (e) {
    e.preventDefault();

    messageDiv.textContent = "Submitting...";
    messageDiv.style.display = "block";
    messageDiv.style.backgroundColor = "beige";
    messageDiv.style.color = "black";
    submitButton.disabled = true;
    submitButton.classList.add("is-loading");

    try {
      const formData = new FormData(this);
      const formDataObj = {};
      for (let [key, value] of formData.entries()) {
        formDataObj[key] = value;
      }
      if (fileInput.files.length > 0) {
        const fileObj = await uploadFile(fileInput.files[0]);
        formDataObj.fileData = fileObj;
      }

      const scriptURL =
        "https://script.google.com/macros/s/AKfycbwQJ2FXp_ZCll8rUVLK8Qb_8qrQIVnr3Pmsq7R1I8OWAbXHWf3qiFjLVrdv66VAG9V9_w/exec";

      const response = await fetch(scriptURL, {
        redirect: "follow",
        method: "POST",
        body: JSON.stringify(formDataObj),
        headers: {
          "Content-Type": "text/plain;charset=utf-8",
        },
      });

      const data = await response.json();

      if (data.status === "success") {
        messageDiv.textContent =
          data.message || "Data submitted successfully!";
        messageDiv.style.backgroundColor = "#48c78e";
        messageDiv.style.color = "white";
        form.reset();
        fileNameDisplay.textContent = "No file selected";
      } else {
        throw new Error(data.message || "Submission failed");
      }
    } catch (error) {
      console.error("Error:", error);
      messageDiv.textContent = "Error: " + error.message;
      messageDiv.style.backgroundColor = "#f14668";
      messageDiv.style.color = "white";
    } finally {
      submitButton.disabled = false;
      submitButton.classList.remove("is-loading");

      setTimeout(() => {
        messageDiv.textContent = "";
        messageDiv.style.display = "none";
      }, 4000);
    }
  });

  const cancelButton = form.querySelector("button.is-danger");
  cancelButton.addEventListener("click", function () {
    form.reset();
    fileNameDisplay.textContent = "No file selected";
    messageDiv.style.display = "none";
  });
</script>
</body>
</html>
